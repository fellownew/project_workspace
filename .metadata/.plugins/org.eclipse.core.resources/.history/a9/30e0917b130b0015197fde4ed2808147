package kr.co.taommall.common.controller;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpSession;

import kr.co.taommall.account.vo.Buyer;
import kr.co.taommall.order.service.OrderService;
import kr.co.taommall.product.service.ProductService;
import kr.co.taommall.product.vo.Product;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;

@Controller

@RequestMapping("/auth")
public class OrderController {
	
	@Autowired
	OrderService service;
	@Autowired 
	ProductService productService;
	
	
/*   
 private String orderId;
 private int productId;
 private int amount;
 private String status;
 private String buyerId;
 private String sellerId;
 
     OrderController에 들어감 @RequestMapping("payment.do") public String payment(){};
        taommall/auth/payment.do
     
        1. orderId - 자동으로 생성되게 seq써서 만들것.
        2. productId는 내가 ${reqeustScope.product.productId}
        3. amount는 ${requestScope.amount}
        4. status default="배송준비";
        5. buyerId <--sessionScope.loginInfo //Controller HttpSession  Buyer buyer = session.getAttribute("loginInfo");
                 buyer.getbuyerId();
        6.          Product product = productService.selectProductNoPaging(productId,null); 
           String sellerId = product.getSellerId();

          Order order = new Order(orderId,productId,amount,status,buyerId,sellerId);
          
          int count = serivce.insertOrder(order);
       	System.out.Println(count);
*/
	
	@RequestMapping("/memberOrderForm.do")
	public String orderList(@RequestParam("productId") int productId, int amount, HttpServletRequest request, HttpSession session) {
		Product product = productService.selectProductByIdNoPaging(productId, null);	//상품번호로 상품 조회
		System.out.println(product);
		if(product!=null){
			request.setAttribute("product", product);
			request.setAttribute("amount", amount);
			return "buyer/buyer_order_form.form";
		}else{
			return "redirect:mainPage.do";
		}
	}
	
	@RequestMapping("/payment.do")
	public String payment(@RequestParam("productId") int productId, int amount,  HttpServletRequest request, HttpSession session){
		
		//status = "배송준비"
		String status = "배송준비";		
		//buyerId
		Buyer buyer = (Buyer)session.getAttribute("loginInfo");
		String buyerId = buyer.getBuyerId();
		//sellerId
		Product product = productService.selectProductByIdNoPaging(productId, null);
		String sellerId = product.getSellerId();
		
		return "buyer/buyer_order_form.form";
		
	};
}
