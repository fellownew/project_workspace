<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="kr.co.taommall.product.dao">
	<sql id="product-select">
		select product_id,product_name,product_price,category,product_info,image_path,regi_date,exp_date,seller_id
		from product
	</sql>
	
	<insert id="insertProduct" parameterType="Product">
		<selectKey resultType="int" keyProperty="productId" order="BEFORE">
			select c_product_id.nextval from dual
		</selectKey>
		insert into product 
		(product_id,product_name,product_price,category,product_info,image_path,regi_date,exp_date,seller_id)
		values
		(#{productId}, #{productName}, #{productPrice}, #{category}, #{productInfo}, #{imagePath}, to_char(sysdate, 'yyyy-mm-dd'),#{expDate}, #{sellerId})
	</insert>
	
	<update id="updateProduct" parameterType="Product">
		update product set product_name=#{productName},product_price=#{productPrice},category=#{category},product_info=#{productInfo},image_path=#{imagePath},exp_date=#{expDate}
		where product_id=#{productId}
	</update>
	
	<update id="updateProductIgnoreImagePath" parameterType="Product">
		update product set product_name=#{productName},product_price=#{productPrice},category=#{category},product_info=#{productInfo},exp_date=#{expDate}
		where product_id=#{productId}
	</update>
	
	<delete id="deleteProduct" parameterType="int">
		delete from product where product_id=#{productId}
	</delete>
	
	<resultMap type="Product" id="product-resultMap">
		<id column="product_id" property="productId"/>
		<result column="product_name" property="productName"/>
		<result column="product_price" property="productPrice"/>
		<result column="category" property="category"/>
		<result column="product_info" property="productInfo"/>
		<result column="image_path" property="imagePath"/>
		<result column="regi_date" property="regiDate"/>
		<result column="exp_date" property="expDate"/>
		<result column="seller_id" property="sellerId"/>
	</resultMap>
	
	<select id="selectAllProduct" resultMap="product-resultMap">
		<include refid="product-select"/>
	</select>
	
	<select id="selectProductById" resultMap="product-resultMap" parameterType="_int">
		<include refid="product-select"/>
		where product_id=#{productId}
	</select>
	
	<select id="selectProductlIKEName" resultMap="product-resultMap" parameterType="String">
		<include refid="product-select"/>
		where product_name like '%'||#{productName}||'%'
	</select>
	
	<select id="selectProductByCategory" resultMap="product-resultMap" parameterType="String">
		<include refid="product-select"/>
		where category=#{category}
	</select>
	
	<select id="selectProductByexpDate" resultMap="product-resultMap" parameterType="String">
		<include refid="product-select"/>
		where expDate=#{expDate}
	</select>
	
	<select id="selectProductBySellerId" resultMap="product-resultMap" parameterType="String">
		<include refid="product-select"/>
		where seller_id=#{sellerId}
	</select>
	
	<select id="selectProductBetweenPrice" resultMap="product-resultMap" parameterType="int[]">
		<include refid="product-select"/>
		where between price #{0} and #{1}
	</select>
	<select id="selectProductMinPrice" resultMap="product-resultMap" parameterType="int">
		<include refid="product-select"/>
		where price &gt;= ${price}
	</select>
	<select id="selectProductMaxPrice" resultMap="product-resultMap" parameterType="int">
		<include refid="product-select"/>
		where price &lt;= ${price}
	</select>
	
	<select id="selectProductCount" resultType="_int">
		select count(*)from product
	</select>
	
	<select id="selectAllProductPaging" parameterType="org.springframework.ui.Model" resultMap="product-resultMap">
		select product_id,product_name,product_price,category,product_info,image_path,regi_date,exp_date,seller_id
		from (
			select ceil(rownum/#{contentsPerPage}) page, product_id,product_name,product_price,category,product_info,image_path,regi_date,exp_date,seller_id
			from (
				<include refid="product-select"/>
				order by exp_date asc
			)
		) 
		where page = #{pageNo}
	</select>
	

	<select id="selectProductPagingBySellerId" parameterType="map" resultMap="product-resultMap">
		select product_id,product_name,product_price,category,product_info,image_path,regi_date,exp_date,seller_id
		from (
			select ceil(rownum/#{contentsPerPage}) page, product_id,product_name,product_price,category,product_info,image_path,regi_date,exp_date,seller_id
			from (
				<include refid="product-select"/>
				where seller_id=#{sellerId}
			)
		) 
		where page = #{pageNo}
	</select>
</mapper>
