<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="order.dao.order">
	
<insert id="insertOrder" parameterType="order" >
<selectKey keyProperty="orderId" order="BEFORE" resultType="_int">select order_no.nextval from dual</selectKey>
   insert into orders values(#{orderId},#{productId},#{amount},#{status},#{buyerId},#{sellerId})
</insert>

<update id="updateOrderById" parameterType="order">
	update orders
	<set>
		<if test="productId != 0">
		product_id = #{productId} ,
		</if>
		<if test="amount != 0" >
		amount=#{amount} ,
		</if>
		<if test="status != null">
		status=#{status}
		</if>
	</set>
	where order_id=#{orderId}
</update>

<delete id="deleteOrderById" parameterType="string">
	delete from orders
	where order_id = ${value}
</delete>
	
<sql id="select-order-default" >
	select 	o.order_id, o.product_id, o.buyer_id, o.amount, o.status, 
			p.product_id, p.product_name, p.product_price, p.category, p.product_info,p.image_path, p.regi_date,p.exp_date, p.seller_id,
			b.buyer_id, b.password, b.name, b.address, b.email, b.phone
	from orders o,product p, buyer b
</sql>

<!-- DefaultOrderResultMap -->
<resultMap type="order" id="resultMap-order-default">
	<id column="order_id" property="orderId"/>
	<result column="product_id" property="productId"/>
	<result column="buyer_id" property="buyerId"/>
	<result column="amount" property="amount"/>
	<result column="status" property="status"/>
	<association property="product" javaType="kr.co.taommall.product.vo.Product" resultMap="kr.co.taommall.product.dao.product-resultMap"/>
	<association property="buyer" javaType="kr.co.taommall.account.vo.Buyer" resultMap="account.dao.buyer.resultMap-buyer-basic"/>
</resultMap>

<select id="selectAllOrder"  resultMap="resultMap-order-default">
<include refid="select-order-default"/>
where o.product_id = p.product_id and o.buyer_id = b.buyer_id
</select>


<select id="selectOrderByProductId" parameterType="string" resultMap="resultMap-order-default">
<include refid="select-order-default"/>
where p.product_id = ${value}
</select>

<select id="selectOrderByOrderId" parameterType="string" resultMap="resultMap-order-default">
<include refid="select-order-default"/>
where o.product_id = p.product_id and o.buyer_id = b.buyer_id and o.order_id = #{value}
</select>

<select id="selectOrderByBuyerId" parameterType="string" resultMap="resultMap-order-default">
<include refid="select-order-default"/>
where o.product_id = p.product_id and o.buyer_id = b.buyer_id and o.buyer_id = #{value}
</select>

<select id="selectOrderByStatus" parameterType="string" resultMap="resultMap-order-default">
<include refid="select-order-default"/>
where o.product_id = p.product_id and o.buyer_id = b.buyer_id and o.status = #{value}
</select>

</mapper>
